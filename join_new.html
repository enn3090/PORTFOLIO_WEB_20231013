<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>회원 가입</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="img/favicon.ico" rel="icon">
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div class="container">
      <h1 class="mt-5 text-center">회원 가입 화면</h1>

      <div id="error-msg" class="alert alert-danger mt-3" style="display:none;"></div>

      <div class="mt-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h3 class="card-title text-center mb-4">회원정보 입력</h3>

            <form onsubmit="registerUser(event)">
              <div class="form-group">
                <label for="name">이름</label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  placeholder="이름을 입력하세요"
                  required
                />
              </div>

              <div class="form-group">
                <label for="email">이메일</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  placeholder="example@email.com"
                  required
                />
              </div>

              <div class="form-group">
                <label for="password">비밀번호</label>
                <input
                  type="password"
                  class="form-control"
                  id="password"
                  placeholder="비밀번호를 입력하세요"
                  required
                />
              </div>

              <div class="form-group">
                <label for="age">나이</label>
                <input
                  type="number"
                  class="form-control"
                  id="age"
                  placeholder="나이를 입력하세요"
                />
              </div>

              <div class="form-group">
                <label for="mobile">전화번호</label>
                <input
                  type="tel"
                  class="form-control"
                  id="mobile"
                  placeholder="010-1234-5678"
                />
              </div>

              <div class="form-group">
                <label for="address">주소</label>
                <input
                  type="text"
                  class="form-control"
                  id="address"
                  placeholder="주소를 입력하세요"
                />
              </div>

              <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary btn-block">
                  회원가입하기
                </button>
                <a href="index.html" class="btn btn-secondary btn-block mt-2">취소 (홈으로)</a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      function registerUser(event) {
        event.preventDefault(); // 새로고침 방지

        // 입력값 가져오기
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const age = document.getElementById('age').value;
        const mobile = document.getElementById('mobile').value;
        const address = document.getElementById('address').value;

        // 기존 유저 목록 불러오기
        let users = JSON.parse(localStorage.getItem('myUsers')) || [];

        // 중복 이메일 체크
        const existingUser = users.find(u => u.email === email);
        if (existingUser) {
          const errorDiv = document.getElementById('error-msg');
          errorDiv.innerText = "이미 가입된 이메일입니다.";
          errorDiv.style.display = "block";
          window.scrollTo(0, 0); // 맨 위로 스크롤
          return;
        }

        // 새 유저 객체 생성
        const newUser = {
          name: name,
          email: email,
          password: password, // 실제로는 암호화해야 하지만 데모용이라 그대로 저장
          age: age,
          mobile: mobile,
          address: address,
          joinDate: new Date().toISOString().split('T')[0]
        };

        // 저장
        users.push(newUser);
        localStorage.setItem('myUsers', JSON.stringify(users));

        // 가입 완료 페이지로 이동
        alert("회원가입이 완료되었습니다!");
        location.href = "join_end.html";
      }
    </script>
  </body>
</html>