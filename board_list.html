<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>블로그 게시판(new)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="img/favicon.ico" rel="icon">
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div class="container">
      <!-- 상단 헤더 -->
      <div class="d-flex justify-content-between align-items-center mt-4 p-3 border rounded bg-light">
        <h1 class="m-0"><a href="index.html" style="text-decoration:none; color:inherit;">블로그 게시판(new)</a></h1>
        <div class="text-right">
          <span id="user-display" class="font-weight-bold text-primary">방문자님 환영합니다.</span>
          <button id="auth-btn" class="btn btn-sm btn-outline-primary ml-3" onclick="handleAuth()">로그인</button>
        </div>
      </div>

      <!-- 검색창 -->
      <form class="mt-4" onsubmit="alert('검색 기능은 데모 버전에서 지원하지 않습니다.'); return false;">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="검색어 입력..." />
          <button type="submit" class="btn btn-primary">검색</button>
        </div>
      </form>

      <!-- 게시글 목록 -->
      <div class="mt-5">
        <table class="table table-hover">
          <thead class="thead-dark">
            <tr>
              <th>글번호</th>
              <th>제목</th>
              <th>작성자</th>
              <th>작성일</th>
              <th>조회수</th>
              <th>좋아요</th>
            </tr>
          </thead>
          <tbody id="boardData">
            <!-- 자바스크립트가 여기에 글을 채웁니다 -->
          </tbody>
        </table>
      </div>

      <!-- 글쓰기 버튼 -->
      <div class="text-right mb-3">
        <button class="btn btn-warning" onclick="goToWrite()">글쓰기</button>
      </div>

      <!-- 페이지네이션 -->
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center" id="pagination">
          <!-- 자바스크립트가 번호를 채웁니다 -->
        </ul>
      </nav>
    </div>

    <script>
      // 설정: 한 페이지당 보여줄 개수
      const itemsPerPage = 5;
      let currentPage = 1;
      let posts = [];

      window.onload = function() {
        checkLoginStatus(); // 로그인 상태 확인
        loadPosts();        // 글 목록 불러오기
      };

      // 1. 로그인 상태 확인 및 헤더 변경
      function checkLoginStatus() {
        const user = JSON.parse(localStorage.getItem('currentUser'));
        const display = document.getElementById('user-display');
        const btn = document.getElementById('auth-btn');

        if (user) {
          display.innerText = user.name + "님 환영합니다.";
          btn.innerText = "로그아웃";
          btn.classList.replace('btn-outline-primary', 'btn-outline-danger');
        } else {
          display.innerText = "방문자님 환영합니다.";
          btn.innerText = "로그인";
          btn.classList.replace('btn-outline-danger', 'btn-outline-primary');
        }
      }

      // 2. 로그인/로그아웃 버튼 기능
      function handleAuth() {
        const user = localStorage.getItem('currentUser');
        if (user) {
          // 로그아웃 처리
          if(confirm("로그아웃 하시겠습니까?")) {
            localStorage.removeItem('currentUser');
            location.reload(); // 새로고침
          }
        } else {
          // 로그인 페이지로 이동
          location.href = "login.html";
        }
      }

      // 3. 글쓰기 버튼 (로그인 체크)
      function goToWrite() {
        const user = localStorage.getItem('currentUser');
        if (!user) {
          alert("로그인이 필요한 서비스입니다.");
          location.href = "login.html";
        } else {
          location.href = "board_write.html";
        }
      }

      // 4. 데이터 불러오기 (샘플 데이터 수정됨!)
      function loadPosts() {
        posts = JSON.parse(localStorage.getItem('myBoardPosts')) || [];

        // 데이터가 하나도 없을 때만 샘플 데이터 생성
        if (posts.length === 0) {
           posts = [
             { 
               id: 4, 
               title: "[개발 환경] Java Spring Boot 개발 환경 설정하기", 
               username: "이영현", 
               newdate: "2025-12-03", 
               viewcount: 42, 
               likecount: 5, 
               content: "1. JDK 설치\n- Spring Boot 3.x 버전을 위해 JDK 17 이상을 설치합니다.\n\n2. IDE 설치 (IntelliJ IDEA)\n- Ultimate 버전 학생 라이센스 등록 완료\n- Lombok 플러그인 활성화\n\n3. 프로젝트 생성\n- Spring Initializr 사용\n- Dependencies: Spring Web, Thymeleaf, Lombok, DevTools 추가\n\n이제 본격적으로 개발을 시작할 준비가 끝났습니다!" 
             },
             { 
               id: 3, 
               title: "[자격증] SQLD 핵심 요약 정리 (데이터 모델링 & SQL)", 
               username: "이영현", 
               newdate: "2025-12-02", 
               viewcount: 128, 
               likecount: 15, 
               content: "1. 데이터 모델링의 이해\n- 엔터티(Entity), 속성(Attribute), 관계(Relationship)의 정의\n- 정규화(Normalization): 1차, 2차, 3차 정규화의 특징\n\n2. SQL 기본 및 활용\n- SELECT 문의 실행 순서: FROM -> WHERE -> GROUP BY -> HAVING -> SELECT -> ORDER BY\n- JOIN의 종류: Inner, Outer, Left, Right Join\n- 서브쿼리와 윈도우 함수 활용법\n\n이번 시험 합격을 목표로 화이팅!" 
             },
             { 
               id: 2, 
               title: "[회고] 개인 포트폴리오 웹사이트 제작기", 
               username: "이영현", 
               newdate: "2025-12-01", 
               viewcount: 55, 
               likecount: 8, 
               content: "Spring Boot로 만들었던 프로젝트를 GitHub Pages로 배포하는 과정에서 많은 것을 배웠습니다.\n특히 동적 서버 기능을 자바스크립트 LocalStorage로 대체하는 과정이 흥미로웠습니다." 
             },
             { 
               id: 1, 
               title: "첫 번째 게시글입니다.", 
               username: "관리자", 
               newdate: "2025-11-30", 
               viewcount: 10, 
               likecount: 2, 
               content: "환영합니다! 게시판 기능이 정상 작동합니다." 
             }
           ];
           localStorage.setItem('myBoardPosts', JSON.stringify(posts));
        }

        renderPage(1); // 1페이지 보여주기
      }

      // 5. 페이지 그리기 (핵심 기능!)
      function renderPage(page) {
        currentPage = page;
        const tbody = document.getElementById('boardData');
        let html = "";

        // 최신글이 위로 오게 정렬
        const sortedPosts = posts.slice().reverse();

        // 페이지 자르기 (Slice)
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageData = sortedPosts.slice(start, end);

        if (pageData.length === 0) {
            html = '<tr><td colspan="6" class="text-center">게시글이 없습니다.</td></tr>';
        } else {
            pageData.forEach((board) => {
            html += `
                <tr>
                <td>${board.id}</td>
                <td>
                    <a href="board_view.html?id=${board.id}">
                    <span>${board.title}</span>
                    </a>
                </td>
                <td>${board.username}</td>
                <td>${board.newdate}</td>
                <td>${board.viewcount}</td>
                <td>${board.likecount}</td>
                </tr>
            `;
            });
        }
        tbody.innerHTML = html;
        renderPagination(sortedPosts.length); // 페이지 번호 그리기
      }

      // 6. 페이지 번호 버튼 만들기
      function renderPagination(totalCount) {
        const pagination = document.getElementById('pagination');
        const totalPages = Math.ceil(totalCount / itemsPerPage);
        let html = "";

        // 이전 버튼
        html += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="renderPage(${currentPage > 1 ? currentPage - 1 : 1}); return false;">&laquo;</a>
                 </li>`;

        // 번호 버튼 (1, 2, 3...)
        for (let i = 1; i <= totalPages; i++) {
            html += `<li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="renderPage(${i}); return false;">${i}</a>
                     </li>`;
        }

        // 다음 버튼
        html += `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="renderPage(${currentPage < totalPages ? currentPage + 1 : totalPages}); return false;">&raquo;</a>
                 </li>`;

        pagination.innerHTML = html;
      }
    </script>
  </body>
</html>