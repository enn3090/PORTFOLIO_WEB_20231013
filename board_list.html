<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>ë¸”ë¡œê·¸ ê²Œì‹œíŒ(new)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div class="container">
      <div class="d-flex justify-content-between align-items-center mt-4 p-3 border rounded bg-light">
        <div class="d-flex align-items-center">
          <h1 class="m-0 mr-3">ë¸”ë¡œê·¸ ê²Œì‹œíŒ(new)</h1>
          <a href="index.html" class="btn btn-outline-dark btn-sm">ğŸ  í™ˆìœ¼ë¡œ</a>
        </div>
        <div class="text-right">
          <span id="user-display" class="font-weight-bold text-primary">ë°©ë¬¸ìë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.</span>
          <button id="auth-btn" class="btn btn-sm btn-outline-primary ml-3" onclick="handleAuth()">ë¡œê·¸ì¸</button>
        </div>
      </div>

      <form class="mt-4" onsubmit="alert('ê²€ìƒ‰ ê¸°ëŠ¥ì€ ë°ëª¨ ë²„ì „ì—ì„œ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return false;">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥..." />
          <button type="submit" class="btn btn-primary">ê²€ìƒ‰</button>
        </div>
      </form>

      <div class="mt-5">
        <table class="table table-hover">
          <thead class="thead-dark">
            <tr>
              <th>ê¸€ë²ˆí˜¸</th>
              <th>ì œëª©</th>
              <th>ì‘ì„±ì</th>
              <th>ì‘ì„±ì¼</th>
              <th>ì¡°íšŒìˆ˜</th>
              <th>ì¢‹ì•„ìš”</th>
            </tr>
          </thead>
          <tbody id="boardData">
            </tbody>
        </table>
      </div>

      <div class="text-right mb-3">
        <button class="btn btn-warning" onclick="goToWrite()">ê¸€ì“°ê¸°</button>
      </div>

      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center" id="pagination">
          </ul>
      </nav>
    </div>

    <script>
      // ì„¤ì •: í•œ í˜ì´ì§€ë‹¹ ë³´ì—¬ì¤„ ê°œìˆ˜
      const itemsPerPage = 5;
      let currentPage = 1;
      let posts = [];

      window.onload = function() {
        checkLoginStatus(); // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        loadPosts();        // ê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
      };

      // 1. ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° í—¤ë” ë³€ê²½
      function checkLoginStatus() {
        const user = JSON.parse(localStorage.getItem('currentUser'));
        const display = document.getElementById('user-display');
        const btn = document.getElementById('auth-btn');

        if (user) {
          display.innerText = user.name + "ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.";
          btn.innerText = "ë¡œê·¸ì•„ì›ƒ";
          btn.classList.replace('btn-outline-primary', 'btn-outline-danger');
        } else {
          display.innerText = "ë°©ë¬¸ìë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.";
          btn.innerText = "ë¡œê·¸ì¸";
          btn.classList.replace('btn-outline-danger', 'btn-outline-primary');
        }
      }

      // 2. ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ê¸°ëŠ¥
      function handleAuth() {
        const user = localStorage.getItem('currentUser');
        if (user) {
          if(confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.removeItem('currentUser');
            location.reload(); 
          }
        } else {
          location.href = "login.html";
        }
      }

      // 3. ê¸€ì“°ê¸° ë²„íŠ¼
      function goToWrite() {
        const user = localStorage.getItem('currentUser');
        if (!user) {
          alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
          location.href = "login.html";
        } else {
          location.href = "board_write.html";
        }
      }

      // 4. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
      function loadPosts() {
        posts = JSON.parse(localStorage.getItem('myBoardPosts')) || [];
        
        // ë°ì´í„° ì—†ì„ ë•Œ ìƒ˜í”Œ ë°ì´í„° ìƒì„± (ìƒëµ ê°€ëŠ¥í•˜ë‚˜ ìœ ì§€)
        if (posts.length === 0) {
           posts = [
             { id: 1, title: "ì²« ë²ˆì§¸ ê²Œì‹œê¸€ì…ë‹ˆë‹¤.", username: "ê´€ë¦¬ì", newdate: "2025-11-30", viewcount: 10, likecount: 2, content: "ë‚´ìš©" },
             { id: 2, title: "[íšŒê³ ] ê°œì¸ í¬íŠ¸í´ë¦¬ì˜¤...", username: "ì´ì˜í˜„", newdate: "2025-12-01", viewcount: 55, likecount: 8, content: "ë‚´ìš©" },
             { id: 3, title: "[ìê²©ì¦] SQLD í•µì‹¬...", username: "ì´ì˜í˜„", newdate: "2025-12-02", viewcount: 128, likecount: 15, content: "ë‚´ìš©" },
             { id: 4, title: "[ê°œë°œ í™˜ê²½] Java Spring...", username: "ì´ì˜í˜„", newdate: "2025-12-03", viewcount: 42, likecount: 5, content: "ë‚´ìš©" }
           ];
           localStorage.setItem('myBoardPosts', JSON.stringify(posts));
        }

        renderPage(1); 
      }

      // 5. í˜ì´ì§€ ê·¸ë¦¬ê¸° (â˜…ìˆ˜ì •ë¨: ì •ë ¬ ë¡œì§ ë³€ê²½â˜…)
      function renderPage(page) {
        currentPage = page;
        const tbody = document.getElementById('boardData');
        let html = "";

        // â˜… í•µì‹¬ ìˆ˜ì • ë¶€ë¶„: ID ê¸°ì¤€ ì˜¤ë¦„ì°¨ìˆœ (1 -> 2 -> 3 -> 4 -> 5) ì •ë ¬
        // a.id - b.id ëŠ” ì‘ì€ ìˆ«ìë¶€í„° ì •ë ¬í•˜ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤.
        const sortedPosts = posts.slice().sort((a, b) => a.id - b.id);

        // í˜ì´ì§€ ìë¥´ê¸°
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageData = sortedPosts.slice(start, end);

        if (pageData.length === 0) {
            html = '<tr><td colspan="6" class="text-center">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        } else {
            pageData.forEach((board) => {
            html += `
                <tr>
                <td>${board.id}</td>
                <td>
                    <a href="board_view.html?id=${board.id}">
                    <span>${board.title}</span>
                    </a>
                </td>
                <td>${board.username}</td>
                <td>${board.newdate}</td>
                <td>${board.viewcount}</td>
                <td>${board.likecount}</td>
                </tr>
            `;
            });
        }
        tbody.innerHTML = html;
        renderPagination(sortedPosts.length); 
      }

      // 6. í˜ì´ì§€ë„¤ì´ì…˜ (ê·¸ëŒ€ë¡œ ìœ ì§€)
      function renderPagination(totalCount) {
        const pagination = document.getElementById('pagination');
        const totalPages = Math.ceil(totalCount / itemsPerPage);
        let html = "";

        html += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="renderPage(${currentPage > 1 ? currentPage - 1 : 1}); return false;">&laquo;</a>
                 </li>`;

        for (let i = 1; i <= totalPages; i++) {
            html += `<li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="renderPage(${i}); return false;">${i}</a>
                     </li>`;
        }

        html += `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="renderPage(${currentPage < totalPages ? currentPage + 1 : totalPages}); return false;">&raquo;</a>
                 </li>`;

        pagination.innerHTML = html;
      }
    </script>
  </body>
</html>