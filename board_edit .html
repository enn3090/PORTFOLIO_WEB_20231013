<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>게시글 수정</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="img/favicon.ico" rel="icon">
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="mb-4">게시글 수정</h1>

      <div class="card">
        <div class="card-header">
          내용 수정하기
        </div>
        <div class="card-body">
          <form onsubmit="updatePost(event)">
            <input type="hidden" id="postId" />

            <div class="form-group">
              <label for="title">제목</label>
              <input
                type="text"
                class="form-control"
                id="title"
                required
              />
            </div>

            <div class="form-group">
              <label for="username">작성자</label>
              <input
                type="text"
                class="form-control"
                id="username"
                readonly
              />
              </div>

            <div class="form-group">
              <label for="content">내용</label>
              <textarea
                class="form-control"
                id="content"
                rows="10"
                required
              ></textarea>
            </div>

            <input type="hidden" id="newdate">
            <input type="hidden" id="viewcount">
            <input type="hidden" id="likecount">

            <div class="d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-secondary" onclick="history.back()">취소</button>
                <button type="submit" class="btn btn-primary">수정 완료</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // 1. 화면이 열리면 기존 글 내용을 불러와서 입력칸에 채웁니다.
      window.onload = function() {
        // 주소창에서 ID 가져오기 (예: board_edit.html?id=1)
        const urlParams = new URLSearchParams(window.location.search);
        const id = parseInt(urlParams.get('id'));

        // 저장소에서 글 목록 가져오기
        let posts = JSON.parse(localStorage.getItem('myBoardPosts')) || [];
        
        // 해당 ID의 글 찾기
        const post = posts.find(p => p.id === id);

        if (post) {
          // 찾은 내용을 입력칸(value)에 넣어주기
          document.getElementById('postId').value = post.id;
          document.getElementById('title').value = post.title;
          document.getElementById('username').value = post.username;
          document.getElementById('content').value = post.content;
          
          // 화면엔 안 보이지만 보존해야 할 데이터
          document.getElementById('newdate').value = post.newdate;
          document.getElementById('viewcount').value = post.viewcount;
          document.getElementById('likecount').value = post.likecount || 0;
        } else {
          alert("존재하지 않는 게시글입니다.");
          location.href = "board_list.html";
        }
      };

      // 2. [수정 완료] 버튼을 누르면 저장하는 함수
      function updatePost(event) {
        event.preventDefault(); // 새로고침 방지

        const id = parseInt(document.getElementById('postId').value);
        const title = document.getElementById('title').value;
        const content = document.getElementById('content').value;

        // 저장소 불러오기
        let posts = JSON.parse(localStorage.getItem('myBoardPosts')) || [];

        // 수정할 글의 위치(index) 찾기
        const index = posts.findIndex(p => p.id === id);

        if (index !== -1) {
          // 내용 덮어쓰기 (제목, 내용만 변경)
          posts[index].title = title;
          posts[index].content = content;

          // 다시 저장하기
          localStorage.setItem('myBoardPosts', JSON.stringify(posts));

          alert("수정되었습니다!");
          // 수정된 상세 페이지로 이동
          location.href = "board_view.html?id=" + id; 
        } else {
          alert("오류가 발생했습니다.");
        }
      }
    </script>
  </body>
</html>